<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WhatsApp - Client Support</title>
    <style>
        /* ==========================================
           1. Core Reset & App Structure (Unchanged)
           ========================================== */
        :root { --wa-header-bg: #ffffff; --wa-chat-bg: #efeae2; --wa-sent: #d9fdd3; --wa-recv: #ffffff; --wa-icon: #54656f; --wa-green: #00a884; --wa-text-main: #111b21; --wa-text-muted: #667781; --wa-sys-bg: #ffeecd; --wa-sys-text: #54656f; --wa-call-bg: #121b22; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        html, body { width: 100%; height: 100%; overflow: hidden; position: fixed; background-color: #000; display: flex; justify-content: center; align-items: center; }
        .app-container { width: 100%; height: 100%; max-width: 480px; background-color: var(--wa-chat-bg); display: flex; flex-direction: column; position: relative; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .header { background-color: var(--wa-header-bg); padding: 5px 10px; display: flex; justify-content: space-between; align-items: center; height: 60px; flex-shrink: 0; z-index: 10; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
        .header-left { display: flex; align-items: center; gap: 8px; cursor: pointer; flex: 1; overflow: hidden;}
        .back-btn { display: flex; align-items: center; }
        .profile-img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; background-color: #ddd; flex-shrink: 0; }
        .user-info { display: flex; flex-direction: column; line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        .user-info .name { font-size: 1.1rem; font-weight: 600; color: var(--wa-text-main); }
        .header-right { display: flex; align-items: center; gap: 18px; flex-shrink: 0;}
        .icon { width: 24px; height: 24px; fill: var(--wa-icon); cursor: pointer; transition: opacity 0.2s; }
        .icon:active { opacity: 0.5; }
        .dropdown-menu { position: absolute; top: 50px; right: 10px; background: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); width: 200px; z-index: 100; display: none; flex-direction: column; padding: 8px 0; transform-origin: top right; animation: scaleIn 0.2s ease; }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .dropdown-menu.active { display: flex; }
        .dropdown-menu div { padding: 12px 20px; font-size: 1rem; color: var(--wa-text-main); cursor: pointer; }
        .dropdown-menu div:hover { background-color: #f5f6f6; }
        .chat-area { flex: 1; padding: 10px 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-size: cover; background-position: center; }
        .chat-area::-webkit-scrollbar { width: 4px; }
        .chat-area::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 10px; }
        .sys-msg { text-align: center; margin: 10px 0; display: flex; justify-content: center; }
        .sys-msg span { background: var(--wa-header-bg); font-size: 0.75rem; color: var(--wa-text-muted); padding: 5px 12px; border-radius: 10px; box-shadow: 0 1px 1px rgba(0,0,0,0.05); }
        .encrypt-msg { background: var(--wa-sys-bg); color: var(--wa-sys-text); font-size: 0.8rem; padding: 8px 12px; border-radius: 10px; text-align: center; line-height: 1.4; box-shadow: 0 1px 1px rgba(0,0,0,0.05); display: flex; gap: 5px; align-items: center; justify-content: center; max-width: 95%; margin: 0 auto; }
        .msg { max-width: 80%; display: flex; flex-direction: column; animation: slideUp 0.2s ease; margin-bottom: 5px;}
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .bubble { padding: 6px 10px; border-radius: 8px; font-size: 0.95rem; color: var(--wa-text-main); box-shadow: 0 1px 1px rgba(0,0,0,0.1); position: relative; word-wrap: break-word; display: flex; align-items: flex-end; gap: 8px; }
        .time { font-size: 0.65rem; color: var(--wa-text-muted); min-width: 45px; text-align: right; margin-bottom: -2px; }
        .msg.sent { align-self: flex-end; }
        .msg.sent .bubble { background-color: var(--wa-sent); border-top-right-radius: 0; }
        .msg.received { align-self: flex-start; }
        .msg.received .bubble { background-color: var(--wa-recv); border-top-left-radius: 0; }
        .attachment-menu { position: absolute; bottom: 65px; left: 10px; right: 60px; background: white; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 20px; display: none; grid-template-columns: repeat(3, 1fr); gap: 20px; z-index: 100; animation: scaleInBottom 0.2s ease; transform-origin: bottom left; }
        @keyframes scaleInBottom { from { opacity: 0; transform: scale(0.8) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .attach-item { display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; }
        .attach-icon { width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center; }
        .attach-icon svg { width: 24px; height: 24px; fill: white; }
        .attach-item span { font-size: 0.85rem; color: var(--wa-text-main); }
        .bg-doc { background: #7f66ff; } .bg-cam { background: #ed415c; } .bg-gal { background: #a229cb; } .bg-aud { background: #f06512; } .bg-loc { background: #1fa750; } .bg-con { background: #009ce4; }
        .input-area { background-color: transparent; padding: 5px; display: flex; flex-direction: row; align-items: flex-end; gap: 5px; width: 100%; box-sizing: border-box; z-index: 10; }
        .input-wrapper { flex: 1 1 auto; min-width: 0; background: var(--wa-header-bg); border-radius: 24px; display: flex; align-items: flex-end; padding: 8px 12px; gap: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); min-height: 48px; }
        .input-wrapper .icon { margin-bottom: 2px; }
        .chat-input { flex: 1 1 auto; min-width: 0; border: none; outline: none; font-size: 1.05rem; padding: 2px 0; background: transparent; max-height: 100px; resize: none; }
        .fab-btn { flex: 0 0 48px; width: 48px; height: 48px; border-radius: 50%; background: var(--wa-green); display: flex; justify-content: center; align-items: center; border: none; box-shadow: 0 2px 4px rgba(0,0,0,0.2); cursor: pointer; transition: transform 0.1s; }
        .fab-btn:active { transform: scale(0.95); }
        .fab-btn svg { width: 22px; height: 22px; fill: white; }
        .voice-recording-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #f0f0f0; border-radius: 30px; display: none; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 20; }
        .voice-timer { display: flex; align-items: center; gap: 10px; font-size: 1.2rem; color: var(--wa-text-main); font-variant-numeric: tabular-nums; }
        .voice-timer .red-dot { width: 8px; height: 8px; background: red; border-radius: 50%; animation: blink 1s infinite; }
        .waveform { flex: 1; display: flex; align-items: center; justify-content: center; gap: 3px; height: 20px; margin: 0 15px; }
        .wave-bar { width: 3px; background: #888; border-radius: 3px; animation: sound 0.4s infinite alternate; }
        .wave-bar:nth-child(even) { animation-duration: 0.6s; } .wave-bar:nth-child(3n) { animation-duration: 0.8s; }
        @keyframes sound { 0% { height: 4px; } 100% { height: 20px; } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        .emoji-panel { height: 250px; background: #f0f0f0; width: 100%; flex-shrink: 0; display: none; flex-direction: column; border-top: 1px solid #ddd; }
        .emoji-tabs { display: flex; justify-content: space-around; padding: 10px; background: white; border-bottom: 1px solid #ddd; }
        .emoji-grid { flex: 1; overflow-y: auto; padding: 10px; display: grid; grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); gap: 10px; font-size: 1.8rem; }
        .emoji-grid span { cursor: pointer; text-align: center; }
        .call-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--wa-call-bg); z-index: 1000; display: none; flex-direction: column; justify-content: space-between; padding: 20px 0 40px 0; color: white; }
        .call-header { text-align: center; position: relative; }
        .call-header .back-down { position: absolute; left: 20px; top: 0; fill: white; width: 28px; height: 28px; cursor: pointer;}
        .call-header h2 { font-weight: 400; font-size: 1.8rem; margin-bottom: 5px; }
        .call-status { font-size: 1.1rem; color: #d1d1d1; margin-bottom: 10px; letter-spacing: 0.5px;} 
        .call-header p { font-size: 0.9rem; color: #aaa; display: flex; justify-content: center; align-items: center; gap: 5px;}
        .call-header p svg { width: 12px; height: 12px; fill: #aaa; }
        .add-person { position: absolute; right: 20px; top: 0; fill: white; width: 28px; height: 28px; cursor: pointer;}
        .call-profile-pic { width: 160px; height: 160px; border-radius: 50%; object-fit: cover; margin: 0 auto; box-shadow: 0 0 30px rgba(0,0,0,0.5); border: 2px solid rgba(255,255,255,0.1); }
        .call-controls { background: #232d36; margin: 0 15px; border-radius: 20px; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; }
        .call-btn { width: 45px; height: 45px; border-radius: 50%; background: #3b464f; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        .call-btn svg { width: 24px; height: 24px; fill: white; }
        .call-btn.active { background: white; } .call-btn.active svg { fill: black; }
        .end-call-btn { background: #ff3b30; width: 55px; height: 55px; }
    </style>
</head>
<body>

<div class="app-container">
    <header class="header">
        <div class="header-left">
            <div class="back-btn"><svg viewBox="0 0 24 24" class="icon"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></svg></div>
            <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" alt="Profile" class="profile-img">
            <div class="user-info"><span class="name">Nusrat Jahan (Admin)</span></div>
        </div>
        <div class="header-right">
            <svg class="icon" id="videoCallBtn" viewBox="0 0 24 24"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"></path></svg>
            <svg class="icon" id="audioCallBtn" viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"></path></svg>
            <svg class="icon" id="menuBtn" viewBox="0 0 24 24"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>
        </div>
        <div class="dropdown-menu" id="dropdownMenu">
            <div>New group</div><div>View contact</div><div>Search</div>
            <div>Media, links, and docs</div><div>Mute notifications</div>
            <div>Disappearing messages</div><div>Chat theme</div><div>More</div>
        </div>
    </header>

    <main class="chat-area" id="chatArea">
        <div class="sys-msg"><span>Today</span></div>
        <div class="encrypt-msg">
            <svg viewBox="0 0 24 24" width="12" height="12" style="width:12px; height:12px; flex-shrink:0; fill:var(--wa-sys-text);">
                <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6zm9 14H6V10h12v10zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z"/>
            </svg>
            Messages and calls are end-to-end encrypted.
        </div>
        <!-- Live messages will appear here -->
    </main>

    <div class="attachment-menu" id="attachMenu">
        <div class="attach-item" onclick="alert('Document opened')"><div class="attach-icon bg-doc"><svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg></div><span>Document</span></div>
        <div class="attach-item" onclick="alert('Camera opened')"><div class="attach-icon bg-cam"><svg viewBox="0 0 24 24"><path d="M4 4h3l2-2h6l2 2h3c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2zm8 3c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 8c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z"/></svg></div><span>Camera</span></div>
        <div class="attach-item" onclick="alert('Gallery opened')"><div class="attach-icon bg-gal"><svg viewBox="0 0 24 24"><path d="M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2zm-11-4l2.03 2.71L16 11l4 5H8l3-4zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6H2z"/></svg></div><span>Gallery</span></div>
        <div class="attach-item" onclick="alert('Audio opened')"><div class="attach-icon bg-aud"><svg viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg></div><span>Audio</span></div>
        <div class="attach-item" onclick="alert('Location opened')"><div class="attach-icon bg-loc"><svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg></div><span>Location</span></div>
        <div class="attach-item" onclick="alert('Contact opened')"><div class="attach-icon bg-con"><svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div><span>Contact</span></div>
    </div>

    <footer class="input-area" id="inputArea">
        <div class="input-wrapper" id="normalInput">
            <svg class="icon" id="emojiBtn" viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S8.33 8 7.5 8 6 8.67 6 9.5 6.67 11 7.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H7.89c.8 2.04 2.78 3.5 5.11 3.5z"></path></svg>
            <input type="text" class="chat-input" id="chatInput" placeholder="Message" autocomplete="off">
            <svg class="icon" id="attachBtn" style="transform: rotate(-45deg);" viewBox="0 0 24 24"><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"></path></svg>
            <svg class="icon" id="cameraBtn" viewBox="0 0 24 24"><path d="M4 4h3l2-2h6l2 2h3c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2zm8 3c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 8c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z"></path></svg>
        </div>
        <div class="voice-recording-ui" id="voiceUI">
            <svg class="icon" id="deleteVoiceBtn" viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"></path></svg>
            <div class="voice-timer"><div class="red-dot"></div> <span id="recordTimer">0:00</span></div>
            <div class="waveform"><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div></div>
            <svg class="icon" id="stopVoiceBtn" style="fill: #ff3b30;" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
        </div>
        <button class="fab-btn" id="mainActionBtn">
            <svg id="micIcon" viewBox="0 0 24 24"><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"></path></svg>
            <svg id="sendIcon" style="display:none; margin-left: 3px;" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
        </button>
    </footer>

    <div class="emoji-panel" id="emojiPanel">
        <div class="emoji-tabs"><span style="font-weight: bold; border-bottom: 2px solid var(--wa-green); padding-bottom: 5px; cursor: pointer;">Smiley & People</span></div>
        <div class="emoji-grid" id="emojiGrid"></div>
    </div>

    <div class="call-screen" id="callScreen">
        <div class="call-header">
            <svg class="back-down" id="endCallTop" viewBox="0 0 24 24"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg>
            <h2 id="callName">Nusrat Jahan</h2>
            <div class="call-status" id="callStatusText">Calling...</div>
            <p><svg viewBox="0 0 24 24" width="12" height="12" style="fill: #aaa; margin-right: 5px;"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6zm9 14H6V10h12v10zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z"/></svg> End-to-end encrypted</p>
        </div>
        <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" class="call-profile-pic" id="audioCallPic">
        <div class="call-controls">
            <div class="call-btn"><svg viewBox="0 0 24 24"><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg></div>
            <div class="call-btn" id="callVideoBtnInside"><svg viewBox="0 0 24 24"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"></path></svg></div>
            <div class="call-btn" id="callSpeakerBtn"><svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg></div>
            <div class="call-btn" id="callMuteBtn"><svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"></path></svg></div>
            <div class="call-btn end-call-btn" id="endCallBtn"><svg viewBox="0 0 24 24"><path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"></path></svg></div>
        </div>
    </div>
</div>

<!-- =====================================
     FIREBASE & LOGIC SCRIPT
     ===================================== -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, push, set, onChildAdded, update, increment } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD1hI53zJb8jFCINxIl2gzpO2T0wlYjyZM",
        authDomain: "my-real-time-calling-app.firebaseapp.com",
        projectId: "my-real-time-calling-app",
        storageBucket: "my-real-time-calling-app.firebasestorage.app",
        messagingSenderId: "247275324084",
        appId: "1:247275324084:web:baaac6efd0dd0b3d0d0de1"
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // =====================================
    // Identity Setup (Client Session)
    // =====================================
    let uid = localStorage.getItem('wa_client_uid');
    let avatar = localStorage.getItem('wa_client_avatar');
    let name = localStorage.getItem('wa_client_name');
    
    if (!uid) {
        uid = Math.floor(10000 + Math.random() * 90000).toString();
        avatar = `https://api.dicebear.com/7.x/avataaars/svg?seed=${uid}`;
        name = `User-${uid}`;
        localStorage.setItem('wa_client_uid', uid);
        localStorage.setItem('wa_client_avatar', avatar);
        localStorage.setItem('wa_client_name', name);
        
        // Initialize User in DB
        set(ref(db, 'chats/' + uid + '/userInfo'), {
            uid: uid, nickname: name, avatar: avatar, lastTime: '', unreadCountAdmin: 0
        });
    }

    // DOM Elements
    const chatInput = document.getElementById('chatInput');
    const micIcon = document.getElementById('micIcon');
    const sendIcon = document.getElementById('sendIcon');
    const mainActionBtn = document.getElementById('mainActionBtn');
    const chatArea = document.getElementById('chatArea');
    const normalInput = document.getElementById('normalInput');
    const voiceUI = document.getElementById('voiceUI');
    const recordTimer = document.getElementById('recordTimer');

    // Toggle Send/Mic Icon
    function toggleSendMicIcon() {
        if (chatInput.value.trim().length > 0) {
            micIcon.style.display = 'none'; sendIcon.style.display = 'block';
        } else {
            micIcon.style.display = 'block'; sendIcon.style.display = 'none';
        }
    }
    chatInput.addEventListener('input', toggleSendMicIcon);

    function getFormattedTime() {
        let now = new Date(), h = now.getHours(), m = now.getMinutes();
        let ampm = h >= 12 ? 'PM' : 'AM'; h = h % 12 || 12; m = m < 10 ? '0'+m : m;
        return h + ':' + m + ' ' + ampm;
    }

    // Real-time Receiving Messages
    function addMessage(text, type, timeStr) {
        const msgWrapper = document.createElement('div');
        msgWrapper.className = `msg ${type}`;
        msgWrapper.innerHTML = `<div class="bubble">${text} <span class="time">${timeStr}</span></div>`;
        chatArea.appendChild(msgWrapper);
        chatArea.scrollTop = chatArea.scrollHeight;
    }

    onChildAdded(ref(db, 'chats/' + uid + '/messages'), (snapshot) => {
        const msg = snapshot.val();
        const uiType = msg.sender === 'client' ? 'sent' : 'received';
        addMessage(msg.text, uiType, msg.time);
    });

    // Voice Recording Logic
    let isRecording = false, recInterval, recSecs = 0;
    function startRecording() {
        isRecording = true; normalInput.style.display = 'none'; voiceUI.style.display = 'flex';
        recSecs = 0; recordTimer.innerText = "0:00";
        recInterval = setInterval(() => {
            recSecs++; let m = Math.floor(recSecs / 60); let s = recSecs % 60;
            recordTimer.innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
        }, 1000);
        micIcon.style.display = 'none'; sendIcon.style.display = 'block';
    }
    function cancelRecording() {
        isRecording = false; clearInterval(recInterval);
        normalInput.style.display = 'flex'; voiceUI.style.display = 'none'; toggleSendMicIcon();
    }
    document.getElementById('deleteVoiceBtn').addEventListener('click', cancelRecording);
    document.getElementById('stopVoiceBtn').addEventListener('click', cancelRecording);

    // Sending Logic (Text or Voice) -> Pushes directly to Firebase
    mainActionBtn.addEventListener('click', () => {
        let time = getFormattedTime();
        if (chatInput.value.trim() !== '') {
            let text = chatInput.value.trim();
            push(ref(db, 'chats/' + uid + '/messages'), { text: text, sender: 'client', time: time, timestamp: Date.now() });
            update(ref(db, 'chats/' + uid + '/userInfo'), { lastTime: time, unreadCountAdmin: increment(1) });
            chatInput.value = ''; toggleSendMicIcon();
        } else if (isRecording) {
            let recText = "ðŸŽ¤ Voice message (" + recordTimer.innerText + ")";
            push(ref(db, 'chats/' + uid + '/messages'), { text: recText, sender: 'client', time: time, timestamp: Date.now() });
            update(ref(db, 'chats/' + uid + '/userInfo'), { lastTime: time, unreadCountAdmin: increment(1) });
            cancelRecording();
        } else {
            startRecording(); 
        }
    });

    chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') mainActionBtn.click(); });

    // UI Menus (Dropdown, Attachment, Emoji)
    const attachMenu = document.getElementById('attachMenu');
    const dropdownMenu = document.getElementById('dropdownMenu');
    document.getElementById('menuBtn').addEventListener('click', (e) => { e.stopPropagation(); dropdownMenu.classList.toggle('active'); attachMenu.style.display = 'none'; });
    document.getElementById('attachBtn').addEventListener('click', (e) => { e.stopPropagation(); attachMenu.style.display = attachMenu.style.display === 'grid' ? 'none' : 'grid'; dropdownMenu.classList.remove('active'); });
    document.addEventListener('click', () => { dropdownMenu.classList.remove('active'); attachMenu.style.display = 'none'; });

    const emojiPanel = document.getElementById('emojiPanel');
    const emojiGrid = document.getElementById('emojiGrid');
    const emojis =["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ˜‚","ðŸ¤£","ðŸ¥²","ðŸ¥¹","â˜ºï¸","ðŸ˜Š","ðŸ˜‡","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜","ðŸ¥°","ðŸ˜˜"];
    emojis.forEach(e => {
        let span = document.createElement('span'); span.innerText = e;
        span.onclick = () => { chatInput.value += e; toggleSendMicIcon(); };
        emojiGrid.appendChild(span);
    });
    document.getElementById('emojiBtn').addEventListener('click', () => { emojiPanel.style.display = emojiPanel.style.display === 'flex' ? 'none' : 'flex'; chatArea.scrollTop = chatArea.scrollHeight; });
    chatInput.addEventListener('focus', () => { emojiPanel.style.display = 'none'; });

    // Calling Simulation UI (Unchanged visually)
    let callAudioCtx, ringInterval, callingTimeout;
    const callScreen = document.getElementById('callScreen');
    function startRealRingtone() {
        if(!callAudioCtx) callAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if(callAudioCtx.state === 'suspended') callAudioCtx.resume();
        function playRing() {
            if(callScreen.style.display === 'none') return;
            const osc1 = callAudioCtx.createOscillator(), osc2 = callAudioCtx.createOscillator();
            const gainNode = callAudioCtx.createGain();
            osc1.type = 'sine'; osc2.type = 'sine'; osc1.frequency.value = 440; osc2.frequency.value = 480; 
            osc1.connect(gainNode); osc2.connect(gainNode); gainNode.connect(callAudioCtx.destination);
            gainNode.gain.setValueAtTime(0.1, callAudioCtx.currentTime);
            osc1.start(); osc2.start(); osc1.stop(callAudioCtx.currentTime + 1.5); osc2.stop(callAudioCtx.currentTime + 1.5);
        }
        playRing(); ringInterval = setInterval(playRing, 4000);
    }
    function openCallScreen(type) {
        callScreen.style.display = 'flex'; document.getElementById('callStatusText').innerText = "Calling...";
        if(type === 'video') { callScreen.style.background = '#000000'; document.getElementById('audioCallPic').style.display = 'none'; 
        } else { callScreen.style.background = 'var(--wa-call-bg)'; document.getElementById('audioCallPic').style.display = 'block'; }
        startRealRingtone();
        callingTimeout = setTimeout(() => { if(callScreen.style.display !== 'none') document.getElementById('callStatusText').innerText = "Ringing"; }, 1500);
    }
    function closeCall() { callScreen.style.display = 'none'; clearInterval(ringInterval); clearTimeout(callingTimeout); }

    document.getElementById('audioCallBtn').onclick = () => openCallScreen('audio');
    document.getElementById('videoCallBtn').onclick = () => openCallScreen('video');
    document.getElementById('endCallBtn').onclick = closeCall;
    document.getElementById('endCallTop').onclick = closeCall;[document.getElementById('callVideoBtnInside'), document.getElementById('callSpeakerBtn'), document.getElementById('callMuteBtn')].forEach(btn => { if(btn) btn.onclick = () => btn.classList.toggle('active'); });

</script>
</body>
</html>
